{"version":3,"file":"react-final-form-arrays.umd.js","sources":["../src/renderComponent.js","../src/defaultIsEqual.js","../src/useConstant.js","../src/useFieldArray.js","../src/FieldArray.js"],"sourcesContent":["// @flow\r\nimport * as React from 'react'\r\nimport type { RenderableProps } from './types'\r\n\r\n// shared logic between components that use either render prop,\r\n// children render function, or component prop\r\nexport default function renderComponent<T>(\r\n  props: RenderableProps<T> & T,\r\n  name: string\r\n): React.Node {\r\n  const { render, children, component, ...rest } = props\r\n  if (component) {\r\n    return React.createElement(component, { ...rest, children, render }) // inject children back in\r\n  }\r\n  if (render) {\r\n    return render(children === undefined ? rest : { ...rest, children }) // inject children back in\r\n  }\r\n  if (typeof children !== 'function') {\r\n    throw new Error(\r\n      `Must specify either a render prop, a render function as children, or a component prop to ${name}`\r\n    )\r\n  }\r\n  return children(rest)\r\n}\r\n","// @flow\r\nconst defaultIsEqual = (aArray: any[], bArray: any[]) =>\r\n  aArray === bArray ||\r\n  (Array.isArray(aArray) &&\r\n    Array.isArray(bArray) &&\r\n    aArray.length === bArray.length &&\r\n    !aArray.some((a, index) => a !== bArray[index]))\r\n\r\nexport default defaultIsEqual\r\n","// @flow\r\nimport React from 'react'\r\n\r\n/**\r\n * A simple hook to create a constant value that lives for\r\n * the lifetime of the component.\r\n *\r\n * Plagiarized from https://github.com/Andarist/use-constant\r\n *\r\n * Do NOT reuse this code unless you know what you're doing.\r\n * Use Andarist's hook; it's more fault tolerant to things like\r\n * falsy values.\r\n *\r\n * @param {Function} init - A function to generate the value\r\n */\r\nexport default function useConstant<T>(init: () => T): T {\r\n  const ref = React.useRef<?T>()\r\n  if (!ref.current) {\r\n    ref.current = init()\r\n  }\r\n  return ref.current\r\n}\r\n","// @flow\r\nimport { useForm, useField } from 'react-final-form'\r\nimport { fieldSubscriptionItems, ARRAY_ERROR } from 'final-form'\r\nimport type { Mutators } from 'final-form-arrays'\r\nimport type { FieldValidator, FieldSubscription } from 'final-form'\r\nimport type { FieldArrayRenderProps, UseFieldArrayConfig } from './types'\r\nimport defaultIsEqual from './defaultIsEqual'\r\nimport useConstant from './useConstant'\r\n\r\nconst all: FieldSubscription = fieldSubscriptionItems.reduce((result, key) => {\r\n  result[key] = true\r\n  return result\r\n}, {})\r\n\r\nconst useFieldArray = (\r\n  name: string,\r\n  {\r\n    subscription = all,\r\n    defaultValue,\r\n    initialValue,\r\n    isEqual = defaultIsEqual,\r\n    validate: validateProp\r\n  }: UseFieldArrayConfig = {}\r\n): FieldArrayRenderProps => {\r\n  const form = useForm('useFieldArray')\r\n\r\n  const formMutators: Mutators = form.mutators\r\n  const hasMutators = !!(formMutators && formMutators.push && formMutators.pop)\r\n  if (!hasMutators) {\r\n    throw new Error(\r\n      'Array mutators not found. You need to provide the mutators from final-form-arrays to your form'\r\n    )\r\n  }\r\n  const mutators = useConstant<Mutators>(() =>\r\n    // curry the field name onto all mutator calls\r\n    Object.keys(formMutators).reduce((result, key) => {\r\n      result[key] = (...args) => formMutators[key](name, ...args)\r\n      return result\r\n    }, {})\r\n  )\r\n\r\n  const validate: FieldValidator = useConstant(\r\n    () => (value, allValues, meta) => {\r\n      if (!validateProp) return undefined\r\n      const error = validateProp(value, allValues, meta)\r\n      if (!error || Array.isArray(error)) {\r\n        return error\r\n      } else {\r\n        const arrayError = []\r\n        // gross, but we have to set a string key on the array\r\n        ;((arrayError: any): Object)[ARRAY_ERROR] = error\r\n        return arrayError\r\n      }\r\n    }\r\n  )\r\n\r\n  const {\r\n    meta: { length, ...meta },\r\n    input,\r\n    ...fieldState\r\n  } = useField(name, {\r\n    subscription: { ...subscription, length: true },\r\n    defaultValue,\r\n    initialValue,\r\n    isEqual,\r\n    validate,\r\n    format: v => v\r\n  })\r\n\r\n  const forEach = (iterator: (name: string, index: number) => void): void => {\r\n    // required || for Flow, but results in uncovered line in Jest/Istanbul\r\n    // istanbul ignore next\r\n    const len = length || 0\r\n    for (let i = 0; i < len; i++) {\r\n      iterator(`${name}[${i}]`, i)\r\n    }\r\n  }\r\n\r\n  const map = (iterator: (name: string, index: number) => any): any[] => {\r\n    // required || for Flow, but results in uncovered line in Jest/Istanbul\r\n    // istanbul ignore next\r\n    const len = length || 0\r\n    const results: any[] = []\r\n    for (let i = 0; i < len; i++) {\r\n      results.push(iterator(`${name}[${i}]`, i))\r\n    }\r\n    return results\r\n  }\r\n\r\n  return {\r\n    fields: {\r\n      name,\r\n      forEach,\r\n      length: length || 0,\r\n      map,\r\n      ...mutators,\r\n      ...fieldState,\r\n      value: input.value\r\n    },\r\n    meta\r\n  }\r\n}\r\n\r\nexport default useFieldArray\r\n","// @flow\r\nimport { version as ffVersion } from 'final-form'\r\nimport { version as rffVersion } from 'react-final-form'\r\nimport type { FieldArrayProps } from './types'\r\nimport renderComponent from './renderComponent'\r\nimport useFieldArray from './useFieldArray'\r\nimport { version } from '../package.json'\r\n\r\nexport { version }\r\n\r\nconst versions = {\r\n  'final-form': ffVersion,\r\n  'react-final-form': rffVersion,\r\n  'react-final-form-arrays': version\r\n}\r\n\r\nconst FieldArray = ({\r\n  name,\r\n  subscription,\r\n  defaultValue,\r\n  initialValue,\r\n  isEqual,\r\n  validate,\r\n  ...rest\r\n}: FieldArrayProps) => {\r\n  const { fields, meta } = useFieldArray(name, {\r\n    subscription,\r\n    defaultValue,\r\n    initialValue,\r\n    isEqual,\r\n    validate\r\n  })\r\n\r\n  return renderComponent(\r\n    {\r\n      fields,\r\n      meta: {\r\n        ...meta,\r\n        __versions: versions\r\n      },\r\n      ...rest\r\n    },\r\n    `FieldArray(${name})`\r\n  )\r\n}\r\n\r\nexport default FieldArray\r\n"],"names":["renderComponent","props","name","render","children","component","rest","React","undefined","Error","defaultIsEqual","aArray","bArray","Array","isArray","length","some","a","index","useConstant","init","ref","useRef","current","all","fieldSubscriptionItems","reduce","result","key","useFieldArray","subscription","defaultValue","initialValue","isEqual","validateProp","validate","form","useForm","formMutators","mutators","hasMutators","push","pop","Object","keys","args","value","allValues","meta","error","arrayError","ARRAY_ERROR","useField","format","v","input","fieldState","forEach","iterator","len","i","map","results","fields","versions","ffVersion","rffVersion","version","FieldArray","__versions"],"mappings":"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"}